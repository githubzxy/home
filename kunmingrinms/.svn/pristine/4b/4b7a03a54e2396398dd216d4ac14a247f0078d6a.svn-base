define("common/grid/GridBtn",["bui/common","bui/grid","bui/mask","common/bar/MsgTbar","common/bar/PageSizeBar"],function(require){var BUI=require("bui/common"),Grid=require("bui/grid"),MsgTbar=(require("bui/mask"),require("common/bar/MsgTbar")),PageSizeBar=require("common/bar/PageSizeBar");return Grid.Grid.extend({renderUI:function(){var _self=this,permissionStore=_self.get("permissionStore"),tbarItems=_self.get("tbarItems"),paging=_self.get("paging"),loadMask=_self.get("loadMask");paging&&_self._renderBbar(),tbarItems&&_self._renderTbar(),permissionStore&&$(".bui-grid-tbar button").hide(),loadMask&&loadMask.set("msg","数据加载中，请稍候...")},_renderBbar:function(){var _self=this,bbarContainer=_self.get("el").find(".bui-grid-bbar");bbarContainer.css("display","block"),bbarContainer.css("width","100%"),new PageSizeBar({store:_self.get("store"),render:bbarContainer,parent:_self}).render()},_renderTbar:function(){var _self=this,tbarItems=_self.get("tbarItems"),tbarContainer=_self.get("el").find(".bui-grid-tbar");tbarContainer.css("display","block"),tbarContainer.css("width","100%");var bar=new MsgTbar({children:tbarItems,render:tbarContainer,parent:_self});bar.render(),_self.set("tbar",bar)},_filterTbarButton:function(allowBtn){this.get("el").find(".bui-grid-tbar").find("button").each(function(){var btnText=$(this).text();BUI.Array.contains(btnText,allowBtn)&&$(this).show()})},_filterGridButton:function(allowBtn){this.get("el").find(".bui-grid-table").find(".grid-command").each(function(){var btnText=$(this).text();BUI.Array.contains(btnText,allowBtn)&&$(this).show()})},bindUI:function(){var _self=this,store=_self.get("store"),permissionStore=_self.get("permissionStore");permissionStore&&store.on("load",function(){permissionStore.hasData()||($(".bui-grid-table .grid-command").hide(),permissionStore.load(permissionStore.get("params"),function(e){var records=permissionStore.getResult(),btnArr=BUI.Array.map(records,function(record){return record.text});_self._filterTbarButton(btnArr),_self._filterGridButton(btnArr)}))})}},{ATTRS:{tbarItems:{},paging:{value:!0},permissionStore:{}}})});